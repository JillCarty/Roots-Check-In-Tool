webpackJsonp([1],[/*!*****************************!*\
  !*** ./public/js/signin.js ***!
  \*****************************/
function(e,exports,t){var a=t(/*! lodash */1),n=t(/*! moment */3),i=t(/*! jquery */90);t(/*! jquery.countdown */106),renderProgressBar=function(e){i(".countDown").show();var t=n(new Date);return e&&t.isAfter(e)?null:void i(".timer").countDown({start_time:t,end_time:e||t.add(1,"ms"),progress:i(".progress-bar"),onComplete:function(){i(".timer").show(),i(".timer").replaceWith('<div class="timer ended">Time\'s Up!</div>')},update_progress:function(e,t){50===Math.floor(e)?i(t).removeClass("progress-bar-success").addClass("progress-bar-warning"):75===Math.floor(e)&&i(t).removeClass("progress-bar-warning").addClass("progress-bar-danger"),t.attr("aria-valuenow",Math.floor(e)),t.css("width",Math.floor(e)+"%"),t.text(Math.floor(e)+"%")}})},renderLocationImage=function(e,t,a,n){e&&(i("#locationImage").append(LOCATION_IMAGES[e.toLowerCase()]),i("#locationText").append(e)),t&&ACTIVITY_IMAGES[t.toLowerCase()]?i("#activityImage").append(ACTIVITY_IMAGES[t.toLowerCase()]):i("#activityImage").append(GET_ACTIVITY(t)),i("#activityText").append(t||""),a?i("#creatorImage").append(CREATOR_IMAGES[a]):n&&(i("#creatorImage").append(FOCUS_AREAS[n]),i("#creatorText").append(n))},renderGroveCalendar=function(e,t){i.get("/api/grove/"+t.id,function(e){window.eventData.groveCalendar=e;var n=a.findIndex(e,function(e){return!e.checkedIn});-1===n&&(n=0,e=a.map(e,function(e){return e.checkedIn=!1,e}),i.ajax("/api/grove/"+t.id,{method:"PUT",data:JSON.stringify({calendar:e}),contentType:"application/json",success:function(){},error:function(e,t,a){}}));var r=e[n];r&&renderLocationImage(r.location,r.activity,null,r.focus_area)})},getCalendar=function(e){var t=n().startOf("day").toISOString(),r=n().endOf("day").toISOString();gapi.client.request("https://www.googleapis.com/calendar/v3/calendars/"+e.email+"/events/?singleEvents=true&timeMin="+t+"&timeMax="+r+"&orderBy=startTime").execute(function(t){var r=n(new Date),s=a.map(t.items,function(e){return{eventId:e.id,location:e.location,creator:e.creator.displayName||e.creator.email,start:e.start.dateTime,end:e.end.dateTime,description:e.description,summary:e.summary}});e.calendar=s,window.userData=e,i.ajax({type:"POST",url:"api/user",data:JSON.stringify(e),contentType:"application/json"});var o=a.find(s,function(e){var t=r,a=n(e.start),i=a.diff(t,"ms");return i<=TRANSITION_LENGTH&&i>0}),c=a.find(s,function(e){var t=n(e.end).subtract(TRANSITION_LENGTH,"ms");return r.isBetween(e.start,t)});if(window.eventData={currentEvent:c,nextEvent:o},c)renderLocationImage(c.location,c.summary,c.creator),renderProgressBar();else if(o)renderProgressBar(o.start),renderLocationImage(o.location,o.summary,o.creator);else{for(var d=60/(EVENT_LENGTH/6e4)+1,l=[],v=0;d>v;v++)l.push(n(new Date).startOf("hour").add(v*EVENT_LENGTH-TRANSITION_LENGTH,"ms"));var p=a.find(l,function(e){return r.isBetween(e,n(e).add(EVENT_LENGTH,"ms"))}).add(TRANSITION_LENGTH,"ms");renderProgressBar(p),renderGroveCalendar(1,e)}})},signinCallback=function(e){e.status.signed_in?(i("#signinButton").hide(),i("#main-container").show(),gapi.client.request("https://www.googleapis.com/plus/v1/people/me?fields=name(familyName%2Cformatted%2CgivenName)%2CdisplayName%2Cemails%2Fvalue%2Cimage%2Furl%2Cid").execute(function(e){var t={id:e.id,name:e.displayName,email:e.emails[0].value,image:e.image.url},a=function(t){t.googleId===e.id&&window.close()},n=io.connect();n.on("SCAN!",a),i("#name").append("<h2>"+e.displayName+"'s Next Step</h2>"),i("#scan-button").attr("href","scan://scan?callback=https%3A%2F%2Froots-elementary.herokuapp.com/scanredirect/"+e.id),i(".scan-button").show(),getCalendar(t)})):console.log("Sign-in state: "+e.error)}}]);
//# sourceMappingURL=SignIn.js.map