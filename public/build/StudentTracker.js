webpackJsonp([2],[function(t,e,i){function n(t){var e=s.find(o,function(e){return e.data.googleId===t.googleId});e&&(e.transitionTimeout&&window.clearTimeout(e.transitionTimeout),e.recentScan=t,e.moveMe.call(e,t))}i(4);var s=i(3),r=i(1),a=i(2),o=[],l="All",u=function(t){this.data=s.pick(t,["_id","email","name","image","googleId"]);var e=a("<div>").addClass("studentLocationDisplay").addClass("col-md-2").attr("id",t.googleId),i=a("<div>").addClass("nameImageContainer");if(i.append('<div class="name">'+t.name+"</div>").append('<div><img class="studentImage" src="'+t.image+'"></div>'),e.append(i),e.append('<div class="studentInfoContainer"></div>'),this.el=e,t.recentScan){scan=t.recentScan,this.recentScan=scan;var n=!1,o=scan.event?scan.event[0]:void 0;o&&o.end&&r(o.end).add(TRANSITION_LENGTH,"ms").isAfter(r())?n=!0:o&&!o.end&&r(scan.time).add(EVENT_LENGTH-TRANSITION_LENGTH,"ms").isAfter(r())&&(n=!0),n?this.moveMe(scan):(this.status="Lost",this.currentLocation="Lost",this.render("Lost"))}else this.status="Lost",this.currentLocation="Lost",this.render("Lost")};u.prototype.updateDisplay=function(){if("Found"===this.status){var t=this.recentScan.event[0],e=s.chain(["summary","activity","focus_area"]).map(function(e){return t[e]}).filter().join(" | ").value(),i=a("<p>").addClass("last-scan-info").addClass("text-primary").text(e);this.el.find(".studentInfoContainer").empty().append(i),this.el.removeClass("Lost").addClass("Found")}else if("Wrong Location"===this.status){this.el.removeClass("Found").addClass("Lost");var i=a("<p>").addClass("last-scan-info").addClass("wrongLocation").text(this.currentLocation),n=a("<p>").addClass("text-primary").addClass("correct-location-info").text(this.recentScan.event[0].location);this.el.find(".studentInfoContainer").empty().append(i,n)}else{var r=this;a.get("/current-event/"+this.data.googleId,function(t){if(r.el.removeClass("Found").addClass("Lost"),t&&t.location){var e=a("<p>").addClass("correct-location-info").addClass("text-primary").text(t.location);r.el.find(".studentInfoContainer").empty().append(e)}})}},u.prototype.render=function(){var t;t="Found"===this.status?this.currentLocation:"Lost";var e=t.split(" ").join("");this.updateDisplay(),a("#"+e).append(this.el)},u.prototype.moveMe=function(t){var e=this;if(this.el&&this.el.remove(),t&&(this.currentLocation=t.scannedLocation),t&&t.correct){this.status="Found";var i=r(new Date);if(t.event.end)var n=r(t.event.end).subtract(TRANSITION_LENGTH,"ms").diff(i);else{for(var a=60/(EVENT_LENGTH/6e4)+1,o=[],l=0;a>l;l++)o.push(r(new Date).startOf("hour").add(l*EVENT_LENGTH-TRANSITION_LENGTH,"ms"));var u=s.find(o,function(t){return i.isBetween(t,r(t).add(EVENT_LENGTH,"ms"))}).add(EVENT_LENGTH,"ms"),n=u.diff(i)}this.transitionTimeout=window.setTimeout(e.moveMe.bind(e,null),n)}else t?this.status="Wrong Location":(this.status="Lost",this.currentLocation="Lost",this.recentScan=null);e.render()},a(function(){s.keys(LOCATION_IMAGES).forEach(function(t){if("ipad center"===t.toLowerCase())var e="iPad Center";else var e=t.split(" ").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join(" ");var i=a("<button>").addClass("btn btn-info btn-block").text(e),n=a("<li>").append(i);a("#location-filters").append(n);var s=a("<h3>").text(e),r=a("<div>").addClass("row").attr("id",e.split(" ").join("")).append(s);a("#locations-container").append(r)}),a("#location-filters button").click(function(t){l=a(this).text(),"All"===l?a("#locations-container > div").show():(a("#locations-container > div").hide(),a("#"+l.split(" ").join("")).show()),a("#location-filters button.btn-warning").removeClass("btn-warning").addClass("btn-info"),a(this).removeClass("btn-info").addClass("btn-warning")});var t=io.connect();t.on("SCAN!",n),a.get("api/user",function(t){o=s.map(t,function(t){return new u(t)}),window.setTimeout(function(){var t=a(".studentLocationDisplay"),e=t.map(function(){return a(this).height()}),i=Math.max.apply(null,e);t.height(i)},500)})})}]);