webpackJsonp([2],[/*!********************************!*\
  !*** ./public/js/lost-kids.js ***!
  \********************************/
function(t,exports,e){function n(t){var e=i.find(r,function(e){return e.data.googleId===t.googleId});e&&(e.transitionTimeout&&window.clearTimeout(e.transitionTimeout),e.recentScan=t,e.moveMe.call(e,t))}var i=e(/*! lodash */1),s=e(/*! moment */3),a=e(/*! jquery */90),r=[],o="All",l=function(t,e){t=t.split(".");var n=t.length;return e.sort(function(e,i){for(var s=0;n>s;)e=e[t[s]],i=i[t[s]],s++;return i>e?-1:e>i?1:0}),e},u=function(t){this.data=i.pick(t,["_id","email","name","image","googleId","absent"]);var e=a("<div>").addClass("studentLocationDisplay").addClass("col-md-2").attr("id",t.googleId),n=a("<div>").addClass("nameImageContainer"),r=a("<button>").addClass("btn btn-xs btn-primary absent-toggle").text(t.absent?"Present":"Absent"),o=a("<div>").append(r);r.on("click",this.toggleAbsent.bind(this));var l=a("<div>").addClass("studentInfoContainer");if(n.append('<div class="name">'+t.name+"</div>").append('<div><img class="studentImage" src="'+t.image+'"></div>'),e.append(n).append(l).append(o),this.el=e,t.absent)this.status="Absent",this.updateDisplay();else if(t.recentScan){scan=t.recentScan,this.recentScan=scan;var u=!1,d=scan.event?scan.event[0]:void 0;d&&d.end&&s(d.end).add(TRANSITION_LENGTH,"ms").isAfter(s())?u=!0:d&&!d.end&&s(scan.time).add(EVENT_LENGTH-TRANSITION_LENGTH,"ms").isAfter(s())&&(u=!0),u?this.moveMe(scan):(this.status="Lost",this.updateDisplay())}else this.status="Lost",this.updateDisplay()};u.prototype.toggleAbsent=function(t){t.preventDefault(),this.status="Absent"===this.status?"Lost":"Absent";var e=this;a.post("/api/user/",{id:this.data.googleId,absent:!this.data.absent},e.updateDisplay.bind(e))},u.prototype.updateDisplay=function(){if("Absent"!=this.status&&this.el.find(".absent-toggle").text("Absent"),"Found"===this.status){var t=this.recentScan.event[0],e=i.chain(["summary","activity","focus_area"]).map(function(e){return t[e]}).filter().join(" | ").value(),n=a("<p>").addClass("last-scan-info").addClass("text-primary").text(e);this.el.find(".studentInfoContainer").empty().append(n),this.el.removeClass("Lost").addClass("Found"),this.render()}else if("Lost"===this.status){var s=this;a.get("/current-event/"+this.data.googleId,function(t){s.el.removeClass("Found").addClass("Lost");var e=a("<p>").addClass("correct-location-info").addClass("text-primary").text(t.location);s.el.find(".studentInfoContainer").empty().append(e),s.currentLocation=t&&t.location||"No Event",s.render()})}else"Absent"===this.status&&(this.el.removeClass("Found").addClass("Lost"),this.currentLocation="Absent",this.el.find(".absent-toggle").text("Present"),this.render())},u.prototype.render=function(){var t=this.currentLocation.split(" ").join("");a("#"+t).append(this.el)},u.prototype.moveMe=function(t){var e=this;if(this.el&&this.el.remove(),t&&(this.currentLocation=t.scannedLocation),t&&t.correct){this.status="Found";var n=s(new Date);if(t.event.end)var a=s(t.event.end).subtract(TRANSITION_LENGTH,"ms").diff(n);else{for(var r=60/(EVENT_LENGTH/6e4)+1,o=[],l=0;r>l;l++)o.push(s(new Date).startOf("hour").add(l*EVENT_LENGTH-TRANSITION_LENGTH,"ms"));var u=i.find(o,function(t){return n.isBetween(t,s(t).add(EVENT_LENGTH,"ms"))}).add(EVENT_LENGTH,"ms"),a=u.diff(n)}this.transitionTimeout=window.setTimeout(e.moveMe.bind(e,null),a)}else t?this.status="Lost":(this.status="Lost",this.currentLocation="Lost",this.recentScan=null)},a(function(){i.keys(LOCATION_IMAGES).forEach(function(t){if("ipad center"===t.toLowerCase())var e="iPad Center";else var e=t.split(" ").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join(" ");var n=a("<button>").addClass("btn btn-info btn-block").text(e),i=a("<li>").append(n);a("#location-filters").append(i);var s=a("<h3>").text(e),r=a("<div>").addClass("row").attr("id",e.split(" ").join("")).append(s);a("#locations-container").append(r)}),a("#location-filters button").click(function(t){o=a(this).text(),"All"===o?a("#locations-container > div").show():(a("#locations-container > div").hide(),a("#"+o.split(" ").join("")).show()),a("#location-filters button.btn-warning").removeClass("btn-warning").addClass("btn-info"),a(this).removeClass("btn-info").addClass("btn-warning")});var t=io.connect();t.on("SCAN!",n),a.get("api/user",function(t){r=i.map(t,function(t){return new u(t)}),l("data.name",r),window.setTimeout(function(){var t=a(".studentLocationDisplay"),e=t.map(function(){return a(this).height()}),n=Math.max.apply(null,e);t.height(n)},500)})})}]);
//# sourceMappingURL=StudentTracker.js.map