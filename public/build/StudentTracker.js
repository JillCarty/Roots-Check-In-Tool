webpackJsonp([2],[function(t,e,i){function n(t,e){var i=o(t).attr("data-name"),n=o(e).attr("data-name");return o(e).hasClass("Found")-o(t).hasClass("Found")||(i>n)-1||1}function s(t){var e=r.find(l,function(e){return e.data.googleId===t.googleId});e&&(e.transitionTimeout&&window.clearTimeout(e.transitionTimeout),e.recentScan=t,e.moveMe.call(e,t))}var r=i(3),a=i(1),o=i(2),l=[],u="All",c=function(t){this.data=r.pick(t,["_id","email","name","image","googleId","absent"]);var e=o("<div>").addClass("studentLocationDisplay").addClass("col-md-2").attr("id",t.googleId).attr("data-name",t.name),i=o("<div>").addClass("nameImageContainer"),n=o("<button>").addClass("btn btn-xs btn-primary absent-toggle").text(t.absent?"Present":"Absent"),s=o("<div>").append(n),l=o("<div>").addClass("studentInfoContainer");if(i.append('<div class="name">'+t.name+"</div>").append('<div><img class="studentImage" src="'+t.image+'"></div>'),e.append(i).append(l).append(s),n.on("click",this.toggleAbsent.bind(this)),this.el=e,t.absent)this.status="Absent",this.updateDisplay();else if(t.recentScan){scan=t.recentScan,this.recentScan=scan;var u=!1,c=scan.event?scan.event[0]:void 0;c&&c.end&&a(c.end).add(TRANSITION_LENGTH,"ms").isAfter(a())?u=!0:c&&!c.end&&a(scan.time).add(EVENT_LENGTH-TRANSITION_LENGTH,"ms").isAfter(a())&&(u=!0),u?this.moveMe(scan):(this.status="Lost",this.updateDisplay())}else this.status="Lost",this.updateDisplay()};c.prototype.toggleAbsent=function(t){t.preventDefault(),this.status="Absent"===this.status?"Lost":"Absent";var e=this;o.post("/api/user/",{id:this.data.googleId,absent:!this.data.absent},e.updateDisplay.bind(e))},c.prototype.updateDisplay=function(){if("Absent"!=this.status&&this.el.find(".absent-toggle").text("Absent"),"Found"===this.status){var t=this.recentScan.event[0],e=r.chain(["summary","activity","focus_area"]).map(function(e){return t[e]}).filter().join(" | ").value(),i=o("<p>").addClass("last-scan-info").addClass("text-primary").text(e);this.el.find(".studentInfoContainer").empty().append(i),this.el.removeClass("Lost").addClass("Found"),this.render()}else if("Lost"===this.status){var n=this;o.get("/current-event/"+this.data.googleId,function(t){n.el.removeClass("Found").addClass("Lost");var e=o("<p>").addClass("correct-location-info").addClass("text-primary").text(t.location);n.el.find(".studentInfoContainer").empty().append(e),n.currentLocation=t&&t.location||"No Event",n.render()})}else"Absent"===this.status&&(this.el.removeClass("Found").addClass("Lost"),this.currentLocation="Absent",this.el.find(".absent-toggle").text("Present"),this.render())},c.prototype.render=function(){var t=this.currentLocation.split(" ").join(""),e=o("#"+t);e.append(this.el);var i=e.find(".studentLocationDisplay").sort(n);i.detach().appendTo(e),this.el.find(".absent-toggle").off("click").on("click",this.toggleAbsent.bind(this))},c.prototype.moveMe=function(t){var e=this;if(this.el&&this.el.remove(),t&&(this.currentLocation=t.scannedLocation),t&&t.correct){this.status="Found";var i=a(new Date);if(t.event.end)var n=a(t.event.end).subtract(TRANSITION_LENGTH,"ms").diff(i);else{for(var s=60/(EVENT_LENGTH/6e4)+1,o=[],l=0;s>l;l++)o.push(a(new Date).startOf("hour").add(l*EVENT_LENGTH-TRANSITION_LENGTH,"ms"));var u=r.find(o,function(t){return i.isBetween(t,a(t).add(EVENT_LENGTH,"ms"))}).add(EVENT_LENGTH,"ms"),n=u.diff(i)}this.transitionTimeout=window.setTimeout(e.moveMe.bind(e,null),n)}else t?this.status="Lost":(this.status="Lost",this.recentScan=null);e.updateDisplay()},o(function(){r.keys(LOCATION_IMAGES).concat("Absent").forEach(function(t){if("ipad center"===t.toLowerCase())var e="iPad Center";else var e=t.split(" ").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join(" ");var i=o("<button>").addClass("btn btn-info btn-block").text(e),n=o("<li>").append(i);o("#location-filters").append(n);var s=o("<h3>").text(e),r=o("<div>").addClass("row").attr("id",e.split(" ").join("")).append(s);o("#locations-container").append(r)}),o("#location-filters button").click(function(t){u=o(this).text(),"All"===u?o("#locations-container > div").show():(o("#locations-container > div").hide(),o("#"+u.split(" ").join("")).show()),o("#location-filters button.btn-warning").removeClass("btn-warning").addClass("btn-info"),o(this).removeClass("btn-info").addClass("btn-warning")});var t=io.connect();t.on("SCAN!",s),o.get("api/user",function(t){l=r.map(t,function(t){return new c(t)})}),o(".all-absent").on("click",function(){o.ajax("/api/user/bulk",{type:"PUT",contentType:"application/json",data:JSON.stringify({absent:!0})})})})}]);