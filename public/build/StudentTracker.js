webpackJsonp([2],[function(e,exports,t){function a(e,t){var a=o(e).attr("data-name"),n=o(t).attr("data-name");return o(t).hasClass("Found")-o(e).hasClass("Found")||(a>n)-1||1}function n(e){var t=i.find(r,function(t){return t.data.googleId===e.googleId});t&&(t.transitionTimeout&&window.clearTimeout(t.transitionTimeout),t.recentScan=e,t.moveMe.call(t,e))}var i=t(1),s=t(3),o=t(90),r=[],d="All",c=function(e){this.data=i.pick(e,["_id","email","name","image","googleId","absent"]);var t=o("<div>").addClass("studentLocationDisplay").addClass("col-md-2").attr("id",e.googleId).attr("data-name",e.name),a=o("<div>").addClass("nameImageContainer"),n=o("<button>").addClass("btn btn-xs btn-primary absent-toggle").text(e.absent?"Present":"Absent"),r=o("<div>").append(n),d=o("<div>").addClass("studentInfoContainer");if(a.append('<div class="name">'+e.name+"</div>").append('<div><img class="studentImage" src="'+e.image+'"></div>'),t.append(a).append(d).append(r),n.on("click",this.toggleAbsent.bind(this)),this.el=t,e.absent)this.status="Absent",this.updateDisplay();else if(e.recentScan){scan=e.recentScan,this.recentScan=scan;var c=!1,l=scan.event?scan.event[0]:void 0;l&&l.end&&s(l.end).add(TRANSITION_LENGTH,"ms").isAfter(s())?c=!0:l&&!l.end&&s(scan.time).add(EVENT_LENGTH-TRANSITION_LENGTH,"ms").isAfter(s())&&(c=!0),c?this.moveMe(scan):(this.status="Lost",this.updateDisplay())}else this.status="Lost",this.updateDisplay()};c.prototype.toggleAbsent=function(e){e.preventDefault(),this.status="Absent"===this.status?"Lost":"Absent";var t=this;o.post("/api/user/",{id:this.data.googleId,absent:!this.data.absent},t.updateDisplay.bind(t))},c.prototype.updateDisplay=function(){if("Absent"!=this.status&&this.el.find(".absent-toggle").text("Absent"),"Found"===this.status){var e=this.recentScan.event[0],t=i.chain(["summary","activity","focus_area"]).map(function(t){return e[t]}).filter().join(" | ").value(),a=o("<p>").addClass("last-scan-info").addClass("text-primary").text(t);this.el.find(".studentInfoContainer").empty().append(a),this.el.removeClass("Lost").addClass("Found"),this.render()}else if("Lost"===this.status){var n=this;o.get("/current-event/"+this.data.googleId,function(e){n.el.removeClass("Found").addClass("Lost");var t=o("<p>").addClass("correct-location-info").addClass("text-primary").text(e.location);n.el.find(".studentInfoContainer").empty().append(t),n.currentLocation=e&&e.location||"No Event",n.render()})}else"Absent"===this.status&&(this.el.removeClass("Found").addClass("Lost"),this.currentLocation="Absent",this.el.find(".absent-toggle").text("Present"),this.render())},c.prototype.render=function(){var e=this.currentLocation.split(" ").join(""),t=o("#"+e);t.append(this.el);var n=t.find(".studentLocationDisplay").sort(a);n.detach().appendTo(t),this.el.find(".absent-toggle").off("click").on("click",this.toggleAbsent.bind(this))},c.prototype.moveMe=function(e){var t=this;if(this.el&&this.el.remove(),e&&(this.currentLocation=e.scannedLocation),e&&e.correct){this.status="Found";var a=s(new Date);if(e.event.end)var n=s(e.event.end).subtract(TRANSITION_LENGTH,"ms").diff(a);else{for(var o=60/(EVENT_LENGTH/6e4)+1,r=[],d=0;o>d;d++)r.push(s(new Date).startOf("hour").add(d*EVENT_LENGTH-TRANSITION_LENGTH,"ms"));var c=i.find(r,function(e){return a.isBetween(e,s(e).add(EVENT_LENGTH,"ms"))}).add(EVENT_LENGTH,"ms"),n=c.diff(a)}this.transitionTimeout=window.setTimeout(t.moveMe.bind(t,null),n)}else e?this.status="Lost":(this.status="Lost",this.recentScan=null);t.updateDisplay()},o(function(){i.keys(LOCATION_IMAGES).forEach(function(e){if("ipad center"===e.toLowerCase())var t="iPad Center";else var t=e.split(" ").map(function(e){return e[0].toUpperCase()+e.slice(1)}).join(" ");var a=o("<button>").addClass("btn btn-info btn-block").text(t),n=o("<li>").append(a);o("#location-filters").append(n);var i=o("<h3>").text(t),s=o("<div>").addClass("row").attr("id",t.split(" ").join("")).append(i);o("#locations-container").append(s)}),o("#location-filters button").click(function(e){d=o(this).text(),"All"===d?o("#locations-container > div").show():(o("#locations-container > div").hide(),o("#"+d.split(" ").join("")).show()),o("#location-filters button.btn-warning").removeClass("btn-warning").addClass("btn-info"),o(this).removeClass("btn-info").addClass("btn-warning")});var e=io.connect();e.on("SCAN!",n),o.get("api/user",function(e){r=i.map(e,function(e){return new c(e)})})})}]);